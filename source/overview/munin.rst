.. -*- coding: utf-8 -*-

=======================================
概要
=======================================

.. sidebar:: 目次

   .. contents:: 
       :depth: 3
       :local:


.. _about-munin:

Munin
====================

Muninはオープンソース [#license]_ として公開されているリソース監視ツールです。様々なサーバ・リソースの情報を集積し、ウェブ・ブラウザ上に表示されているグラフから、どのような状況が発生しているのかを簡単に把握できます。2002年にプロジェクトが公開されて以来、現在に至るまでコミュニティが主体で開発が行われています。

以下では Munin の特長と機能概要を紹介します。

グラフを参照するためのシンプルなインターフェース
==================================================

Munin が生成するリソース・グラフを参照するには、ブラウザでページを開くだけです。何ら特別なソフトウェアを必要としません。グラフで見られる情報は1台だけではありません。複数台のサーバのリソースを１つの画面に一覧表示したり、日・週・月・年にわたってグラフを表示したり、指定期間内の特定リソースを拡大ズームして表示する機能もあります。

グラフ参照がシンプルなので、それぞれの担当者に利点があります。

* 運用担当者…サーバにログインしなくても、グラフを見るだけで瞬時に状況を把握
* 開発者…コードをデプロイした前後で、システムや性能に変化や影響を把握
* 経営・管理部門…システムリソースの利用状況を可視化するため、性能・コスト評価時の参考に

Muninが行うのは、単純なHTMLファイルやグラフ画像ファイルを出力するだけです。そのため、もしMunin上のグラフを記録する必要があれば、そのまま名前をつけて保存し、WordやExcelなど他のアプリケーションにコピーしたり、HTMLファイルを含めて保存したりできます。また、Muninの画面に認証やアクセス制限が必要であれば、ApacheやNginxなどウェブサーバ上で任意の設定変更を行い、簡単に制限を施せます。

セットアップや設定・運用管理のシンプルさ
========================================

Muninでグラフを作成するまでのセットアップ作業も、非常に簡単です。セットアップは、 ``yum`` や ``apt`` コマンドを使えば数ステップで完結します。その後、監視対象サーバでは監視用のデータ収集エージェント(munin-node)を起動し、グラフ生成サーバ(Muninマスタ)で、その監視対象の情報をテキスト形式のファイルに記述するだけです。

Muninの内部では、データの保管にはRRDTool [#rrdtool]_ が採用するRRD形式(Round Robin Database)を使います。RRD形式のファイルは、初回のファイル作成時以降、ディスク容量が増えない特長があります。そのため、導入後も容量が増えるかどうか心配する必要は無いため、Muninサーバ自身の管理が簡単です。

他の監視ツールとは異なり、MySQLやPostgreSQL等のリレーショナル・データベース(RDBMS)を使いません。データベースが不要なので多くの利点があります。例えば、データベース自身を管理するために、性能のチューニングや、セキュリティ対策の実施や、ディスク容量を監視する必要がなくなります。Muninを使うために、自身の管理や運用の手間が増えない点もMuninを使う上での利点と言えます。

プラグイン方式による自由度の高い拡張性
========================================

プラグインを使った拡張性もMuninの魅力の１つです。サーバのコマンドライン上で取得できるデータであれば、何でもグラフ化できます。初期状態から、システムのCPUやメモリ・ディスク容量・ネットワークなどの情報を取得します。これはプラグインと呼ばれる仕組みを通してMuninが取得します。実態はスクリプト・ファイルです。Muninのプラグインのデータを返すのであれば、シェルスクリプトだけでなく、Perl、Ruby、Pythonなどのシェルスクリプトだけでなく、C言語やGo言語などのバイナリを使うこともできます。また、監視対象がREST等のインターフェースを持っていれば、それらのデータも取得できます。

Muninが何のリソース情報を収集するかはどうかは、Muninノード上のプラグインに設定が委ねられます。プラグインとは、グラフをどのように表示するかの定義情報を持ち、サーバ上の数値を取得するプログラムを実行します。プラグインの多くはシェル・スクリプトかPerl等のスクリプトで記述されています。必要があれば自分でプラグインを書き換えたり、新しく作成できる自由度の高さもあります。

プラグインは、GitHubで共有・開発が行われています。公式レポジトリ [#munin-repos]_ で開発されている約230の公式プラグインの他、コミュニティ有志による約180のサードパーティー製のプラグイン [#munin-3rd-repos]_ が公開されています。

その他の機能
====================

Munin には他にも機能があります。

アラート通知機能
--------------------

監視対象プラグインで、指定した閾値を超えると通知します。通知方法は、メール送信やsyslogへのログ記録の他、Nagios への通知や外部スクリプトを実行する機能です。ただし、通知のタイミングは Munin の実行タイミング（標準で5分毎）のため、よりクリティカルな運用を行う場合は、Nagios や Zabbix などの通知機能を持つツールを使い、別途監視することをお勧めします。

SNMP 監視
--------------------

Munin の SNMP プラグインを使うことで、SNMP 機器から情報を取得できます。監視対象はエージェント（munin-node）が動作する環境だけではありません。

セキュリティ
------------------------------

munin-nodeは通信用にポート4949(TCP)を標準で用います。接続可能なMuninマスタを、IPアドレスやCIDR単位で制限する機能があります。

リモートSSH接続、非同期データ取得機能
----------------------------------------

munin-nodeの通信に標準のエージェントを経由せず、SSHを使ったデータの取得を行えます。その際、Muninマスタがデータ取得を行うタイミングではなく、非同期にデータを取得する方法もあります。監視対象のセキュリティを高めたい場合や、監視対象のネットワーク・セグメントが分かれている場合に有用な方法です。




.. rubric:: 脚注

.. [#license] Muninの利用条件は、GNU General Public License v2.0に準拠。
.. [#rrdtool] RRDTool https://oss.oetiker.ch/rrdtool/
.. [#munin-repos] https://github.com/munin-monitoring/munin/tree/devel/plugins
.. [#munin-3rd-repos] https://github.com/munin-monitoring/contrib/tree/master/plugins

